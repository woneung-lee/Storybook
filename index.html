<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎨 만화책 이어쓰기 게임</title>
    <meta name="description" content="초등학생을 위한 협동 학습형 실시간 이야기 만들기 게임">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- 로그인 화면 -->
        <div id="loginScreen" class="login-screen">
            <div class="comic-panel">
                <div class="star-decoration" style="top: 10px; left: 20px;">⭐</div>
                <div class="star-decoration" style="top: 30px; right: 30px;">✨</div>
                <div class="star-decoration" style="bottom: 20px; left: 40px;">💫</div>
                
                <h1 class="comic-title">이어쓰기<br>스토리북!</h1>
                <p class="comic-subtitle">🎨 함께 만드는 신나는 이야기 🎨</p>
                
                <div class="role-selection">
                    <button class="role-btn teacher" id="teacherRoleBtn">
                        👨‍🏫<br>선생님
                    </button>
                    <button class="role-btn student" id="studentRoleBtn">
                        👦<br>학생
                    </button>
                </div>

                <div id="loginForm" class="login-form hidden">
                    <!-- 선생님 로그인 -->
                    <div id="teacherLogin" class="hidden">
                        <div class="input-group">
                            <label>🔐 비밀번호</label>
                            <input type="password" id="teacherPassword" placeholder="비밀번호를 입력하세요">
                        </div>
                        <button class="submit-btn" id="teacherSubmitBtn">입장하기!</button>
                    </div>

                    <!-- 학생 로그인 -->
                    <div id="studentLogin" class="hidden">
                        <div class="input-group">
                            <label>👤 내 이름</label>
                            <input type="text" id="studentName" placeholder="이름을 입력하세요">
                        </div>
                        <button class="submit-btn" id="studentSubmitBtn">입장하기!</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 게임 화면 -->
        <div id="gameScreen" class="game-screen">
            <!-- 헤더 바 (선생님만) -->
            <div id="headerBar" class="header-bar">
                <div class="header-item">
                    <span class="header-icon">👥</span>
                    <div>
                        <div class="header-label">접속 중</div>
                        <div class="header-value" id="studentCount">0명</div>
                    </div>
                </div>
                <div class="header-item">
                    <span class="header-icon">📝</span>
                    <div>
                        <div class="header-label">작성된 문장</div>
                        <div class="header-value" id="totalSentences">0개</div>
                    </div>
                </div>
                <div class="header-item">
                    <span class="header-icon">🎯</span>
                    <div>
                        <div class="header-label">현재 상태</div>
                        <div class="header-value" id="gameStatus">대기중</div>
                    </div>
                </div>
                <button class="btn btn-warning" id="logoutBtn" style="width: auto; padding: 12px 35px;">
                    🚪 나가기
                </button>
            </div>

            <!-- 선생님 화면 -->
            <div id="teacherView" class="hidden">
                <div class="teacher-dashboard">
                    <!-- 제어 패널 -->
                    <div class="control-panel">
                        <h2 class="panel-title">🎮 제어판</h2>
                        
                        <!-- 조 개수 설정 -->
                        <div class="form-group">
                            <label>🎨 조 개수 (1~10)</label>
                            <div class="counter-control">
                                <button class="counter-btn" id="decreaseTeamBtn">−</button>
                                <div class="counter-display" id="teamCountDisplay">5개조</div>
                                <button class="counter-btn" id="increaseTeamBtn">+</button>
                            </div>
                        </div>

                        <!-- 주제 설정 -->
                        <div class="form-group">
                            <label>💡 이야기 주제</label>
                            <textarea id="storyTopic" placeholder="예: 어느 날 우리 반에 외계인이 찾아왔다..."></textarea>
                        </div>
                        <button class="btn btn-primary" id="setTopicBtn">🎯 주제 설정</button>

                        <!-- 바퀴수 제한 -->
                        <div class="form-group small-input">
                            <label>🔄 바퀴수 제한 (0 = 무제한)</label>
                            <input type="number" id="maxRounds" value="0" min="0" max="99">
                        </div>
                        
                        <!-- 학생 추가 -->
                        <div class="form-group">
                            <label>👤 학생 이름</label>
                            <input type="text" id="newStudentName" placeholder="학생 이름 입력">
                        </div>
                        <div class="form-group">
                            <label>🎨 조 배정</label>
                            <select id="studentTeam">
                                <option value="">조 선택</option>
                            </select>
                        </div>
                        <button class="btn btn-success" id="addStudentBtn">➕ 학생 추가</button>

                        <!-- 학생 목록 -->
                        <div class="form-group">
                            <label>📋 학생 목록</label>
                            <div id="studentList" class="student-list"></div>
                        </div>

                        <!-- 게임 제어 -->
                        <button class="btn btn-info" id="startGameBtn">🚀 게임 시작</button>
                        <button class="btn btn-danger" id="endGameBtn">🏁 게임 종료</button>
                        <button class="btn btn-warning" id="resetGameBtn">🔄 게임 초기화</button>
                    </div>

                    <!-- 팀 모니터링 -->
                    <div>
                        <h2 class="panel-title" style="margin-bottom: 20px;">📊 실시간 모니터링</h2>
                        
                        <!-- 현재 주제 표시 -->
                        <div id="currentTopicDisplay" class="current-topic-display hidden">
                            <div class="current-topic-label">💡 현재 주제</div>
                            <div class="current-topic-text" id="currentTopicText">-</div>
                        </div>

                        <div id="teamsMonitor" class="teams-monitor"></div>
                    </div>
                </div>
            </div>

            <!-- 학생 화면 -->
            <div id="studentView" class="hidden student-view">
                <h1 class="story-title" id="teamTitle">우리 조 이야기</h1>

                <!-- 주제 표시 -->
                <div id="topicDisplay" class="topic-bubble hidden">
                    <div class="topic-label">📖 오늘의 주제</div>
                    <div class="topic-text" id="topicText">-</div>
                </div>

                <!-- 전체 이야기 보기 버튼 -->
                <div class="view-all-story-btn">
                    <button id="viewMyTeamStoryBtn">📖 전체 이야기 보기</button>
                </div>

                <!-- 문장 목록 -->
                <div id="sentencesContainer" class="sentences-container"></div>

                <!-- 입력 영역 -->
                <div class="input-area">
                    <h3 class="input-title">✍️ 내 차례!</h3>
                    <div id="writingStatus" class="writing-status">
                        게임이 시작되기를 기다리는 중...
                    </div>
                    <textarea id="storyInput" class="story-input" placeholder="여기에 한 문장을 적어보세요..." disabled></textarea>
                    <div class="action-buttons">
                        <button class="btn btn-success" id="submitBtn" disabled>
                            📝 문장 제출
                        </button>
                    </div>
                </div>

                <!-- 학생용 나가기 버튼 -->
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-warning" id="studentLogoutBtn" style="width: auto; padding: 12px 35px;">
                        🚪 나가기
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 조별 상세보기 모달 -->
    <div id="teamDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTeamTitle">1조 상세보기</h2>
                <button class="close-btn" id="closeTeamDetailBtn">✕ 닫기</button>
            </div>

            <!-- 통계 -->
            <div class="team-stats">
                <div class="stat-card">
                    <div class="stat-label">총 문장 수</div>
                    <div class="stat-value" id="modalTotalSentences">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">참여 인원</div>
                    <div class="stat-value" id="modalMemberCount">0명</div>
                </div>
            </div>

            <!-- 전체 이야기 -->
            <div style="margin-bottom: 20px;">
                <h3 class="author-stats-title">📖 전체 이야기</h3>
                <div class="full-story" id="modalFullStory"></div>
            </div>

            <!-- 문장별 상세 -->
            <div style="margin-bottom: 30px;">
                <h3 class="author-stats-title">📝 문장별 상세</h3>
                <div id="modalStoryContent" class="sentences-container" style="max-height: 400px;"></div>
            </div>

            <!-- 작성자별 통계 (맨 밑으로 이동) -->
            <div class="author-stats">
                <h3 class="author-stats-title">👥 작성자별 통계</h3>
                <div id="authorStatsList"></div>
            </div>
        </div>
    </div>

    <!-- 게임 종료 결과 모달 -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🏆 게임 결과</h2>
                <button class="close-btn" id="closeResultsBtn">✕ 닫기</button>
            </div>

            <!-- 팀 선택 화면 -->
            <div id="teamSelectionView">
                <h3 class="author-stats-title" style="text-align: center; margin-bottom: 20px;">
                    📚 결과를 확인할 조를 선택하세요
                </h3>
                <div id="teamSelectionGrid" class="team-selection-grid"></div>
            </div>

            <!-- 선택한 팀 결과 화면 -->
            <div id="teamResultView" class="hidden">
                <div class="back-to-selection-btn">
                    <button id="backToSelectionBtn">⬅️ 조 선택으로 돌아가기</button>
                </div>
                <div id="selectedTeamResult"></div>
            </div>
        </div>
    </div>

    <!-- 알림 영역 -->
    <div id="notificationArea"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- App JavaScript -->
    <script src="app.js"></script>
</body>
</html>
